1. 你有JVM调优经验吗？

```java
答：有，根据我自己的理解JVM调优不是一上来就进行各种JVM参数优化；
1、首先我们会排查是不是关系型数据库遇到了瓶颈，这个过程会分析自己建的索引是否合理、是否需要引入缓存(分布式缓存)、(是否需要分库分表等)。
2、然后我们会考虑是不是需要扩容（横向和纵向都会考虑），这个过程中会去排查是不是系统压力过大，或者是系统的硬件能力不足导致的系统频繁出现问题。
3、其实出现问题很可能是代码的问题，这就需要从代码层面进行排查和优化，扩容虽然能解决大部分问题，可是都需要花钱的，这个过程我们回去排查自己写的代码是否存在资源浪费的问题，又或者在逻辑上存在可以优化的地方，比如通过并行的方式处理某些请求。
4、再接着，JVM层面上进行优化，这个过程我们会去观察JVM是否存在多次GC的问题
5、最后，网络和操作系统层面排查，这个过程查看内存/cpu/网络/硬盘读写指标是否正常等等。
在我的理解下，调优JVM其实就是理解JVM内存结构以及各种垃圾收集器前提下，结合自己现有的业务来调整参数，对服务器性能进行压榨，使应用稳定运行。调优主要参考指标有吞吐量、响应时间（停顿时间）、和垃圾收集频率，基于这些指标我们可能需要调整：
1、内存区域大小以及相关策略（比如整块堆内存占多少、新生代占多少、老年代占多少、Survivor占多少、晋升老年代的条件等，主要参数-Xms:设置堆的初始值、-Xmx:设置堆的最大值、-Xmn:表示年轻代的大小、-XX：SurvivorRatio:伊甸区和幸存区的比例等等，按照经验来说IO密集型可以稍微把年轻代空间加大点，因为大多数对象在年轻代就会灭亡，内存计算密集型的可以稍微把老年代空间加大点，对象存活时间会长些）
2、垃圾回收器（选择合适的垃圾回收器，以及各个垃圾回收器的各种调优参数，比如-XX:+UseG1GC:指定JVM使用的垃圾回收器为G1、-XX：MaxGCPauseMills:设置目标停顿时间、-XX：InitiatingHeapOccupancyPercent:当整个堆内存达到一定比例全局并发标记阶段就会被启动等等）
一般来说使用JVM默认的参数就能解决大多数问题，一般是遇到问题进行调优的，遇到问题需要利用一些工具进行排查：
1、top命令观察到问题：内存不断增长CPU占用率居高不下
2、top -Hp观察进程中的线程，哪个线程CPU和内存占比高
3、jps定位具体的java进程，jstack定位线程情况，重点关注WAITING、BLOCKED
4、jstat -gc 动态观察GC情况
5、jmap -histo 进程号 | head -20，查找有多少对象产生（定位占内存多的对象），也可以用jmap将jvm内存信息dump到文件，使用MAT或者JvisualVM等工具分析，不过dump过程不能轻易去操作，过程会造成服务卡顿，影响使用。
也可以使用阿里的Arthas工具，里面也涵盖了一些命令，有助于分析。
我曾经遇到的JVM调优问题：
1、当时做hbase数据迁移的时候，同步数据很慢，把垃圾回收器改成了G1，停顿时间设置了好像是2ms后，速度有明显的提升。
2、当时有一个应用往磁盘写入数据量巨大，动不动就OOM，调整了JVM堆的大小，由于偏向于IO操作，把新生代调大了，问题得到了解决。
3、还有一个问题当时我们的系统频繁FullGC，服务勉强能够使用，每次在晚上都重启一下服务，最后加内存并更换了G1，问题得到了解决。
```

